---
title: "Assignment 1"
author: "A. BOGNAR"
date: "11/27/2021"
output: pdf_document
---

```{r , include = FALSE , warning = FALSE}
# Data Loading and cleaning

rm(list=ls())
library(tidyverse)
library(modelsummary)
library(kableExtra)
library(ggpubr)


cps_earnings <- read_csv("https://osf.io/4ay9x/download")

  
  #https://data.nber.org/morg/docs/cpsx.pdf


cps_earnings_filtered <- cps_earnings %>% 
  filter( grade92 >= 44 & grade92 <= 46 ) %>%
  filter( age >= 24 & grade92 <= 65 ) %>% 
  filter( lfsr94 == "Employed-At Work" ) %>%
  filter( uhours >= 20 ) %>% 
  filter( earnwke > 5 )


cps_earnings_filtered <- cps_earnings_filtered %>% 
                         mutate( female =  as.numeric( sex == 2 )) %>%
                         mutate( wages_per_hour = earnwke / uhours) %>%
                         mutate( log_wages_per_hour = log( wages_per_hour )) 

cps_earnings_filtered_teach <- cps_earnings_filtered %>%
          mutate( sample = ifelse( occ2012 == 2200 , 1 , 0 ) ) 

earnings_teachers <- cps_earnings_filtered_teach %>% filter( sample == 1 )

table(earnings_teachers$female)
# 480 males, 471 females

```



```{r , echo = FALSE , warning = FALSE}
# data table

tmp <- earnings_teachers %>% 
      select( female  ,  grade92 ,  
              'Weekly earnings' =  earnwke , 
              'Hourly Earnings' = wages_per_hour ,
              'Ln Hourly Earnings' = log_wages_per_hour ) %>% 
      mutate( 'Gender' = ifelse(female == 0 , 'Male' , 'Female' ) ,
              'Level of Education' = ifelse(grade92 == 44 , 'Masters' , 
                                      ifelse(grade92 == 45 , 'Professional Degree' , 'PhD' )))

P95 <- function(x){ quantile(x,.95,na.rm=T)}
datasummary( (Gender  + `Level of Education`) * `Weekly earnings` + `Hourly Earnings` + `Ln Hourly Earnings`  ~ Mean + SD + Min + Max + Median + P95 + N , data = tmp )

```


```{r , echo = FALSE , warning = FALSE}
# Lowess graphs
p1 <- ggplot( data = earnings_teachers , aes( x = female , y = log_wages_per_hour )) +
  geom_point( color = 'red', size = 2, shape = 16, ) + 
  scale_x_continuous(expand=c(0.01, 0.01), limits = c(0, 1),   breaks=seq(0, 1,   by=1)) + 
  scale_y_continuous(expand=c(0.01, 0.01),limits = c(0, 5), breaks=seq(0, 5, by=1)) +
  geom_smooth( method = 'loess', formula = y ~ x) +
  labs(x = "Gender",y = "Log of wages (USD)")


p2 <- ggplot( data = earnings_teachers , aes( x = grade92, y = log_wages_per_hour )) +
  geom_point( color = 'red', size = 2, shape = 16, ) + 
  scale_x_continuous(expand=c(0.01, 0.01), limits = c(44, 46),   breaks=seq(44, 46,   by=1)) + 
  scale_y_continuous(expand=c(0.01, 0.01),limits = c(0, 5), breaks=seq(0, 5, by=1)) +
  geom_smooth( method = 'loess', formula = y ~ x) +
  labs(x = "Level of Education",y = "Log of wages (USD)")


p3 <- ggplot( data = earnings_teachers , aes( x = female, y =  grade92)) +
  geom_point( color = 'red', size = 2, shape = 16, ) + 
  scale_x_continuous(expand=c(0.01, 0.01), limits = c(0, 1),   breaks=seq(0, 1,   by=1)) + 
  scale_y_continuous(expand=c(0.01, 0.01),limits = c(44, 46), breaks=seq(44, 46, by=1)) +
  geom_smooth( method = 'loess', formula = y ~ x) +
  labs(x = "Gender",y = "Level of Education")

linear_assoc_figs <- ggarrange(p1, p2,
                              hjust = -0.6,
                              ncol = 1, nrow = 2)
linear_assoc_figs

```

